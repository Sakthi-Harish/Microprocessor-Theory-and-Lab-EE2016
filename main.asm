;
; sakthi_partc_ee2016.asm
;
; Created: 07-11-2020 5.57.14 AM
;
; Author : Sakthi Harish D T
; Roll.No. EE19B054

;


;                                *****************//5-Tap & 32-Tap FIR Filter//***************** 
start:
    .CSEG;
	LDI R17,5;         //****NOTE:MENTION THE ORDER OF THE TAP , (i.e.)0x05 for 5-TAP and 0x20 for 32-TAP FIR FILTER****//
	
	LDI R20,0XCE;         //NUMBER OF OUTPUT SAMPLES REQUIRED
	MOV R8,R17;      // buffer registers
	MOV R9,R17;
	LDI XL,0X3E;       //SRAM address for storing the Coefficients (from 0x043E) 
	LDI XH,0X04;
	LDI ZL, LOW(COEFF<<1);       //Loading address of Coefficients in the Flash memory to Pointer register
	LDI ZH, HIGH(COEFF<<1);
	
	LOOP1: LPM R23,Z;
	ADIW ZH:ZL,1;              //loading the value of coefficients into registers     
	ST X+, R23;             //storing the coefficients into the SRAM 
	DEC R17;
	CPI R17,0X00;
	BRNE LOOP1;

	LDI YL,0X60;                   //SRAM location pointer for the OUTPUTS( starting from 0x0060 )
	LDI YH,0X00;
	LDI ZL, LOW(INPUT<<1);           //loading the address of input location into the Pointer registers
	LDI ZH, HIGH(INPUT<<1); 
	            
	LDI R21,0X01;              //buffer registers
	LDI R22,0X01;           !
	LOOP3:        //CONVOLUTION OPERATION 
    CPI R20,0XCE;    //comparing the number of counts
	BREQ SKIP;
    ADIW ZH:ZL,0X06;   //*****$$$$$$$******NOTE: Put N+1 in this line, where N is the number of Tap******$$$$$$$******//
	SKIP:LDI XL,0X3E;       //pointer location for coefficients in SRAM(from 0x043E)
	LDI XH,0X04;
	MOV R8,R9;
	LDI R24,0X00;         // buffer registers
	LDI R25,0X01;
	CLR R4;
	CLR R5;
	CLR R6;
	
	LOOP2:
	
	LD R18,X+;     //Loading the Coefficients
	LPM R19,Z;       //***NOTE: This line and the following line is used for SINE and WHITENOISE inputs only. Change to comment in DC case***//
	SBIW ZH:ZL,1;
    ;LDI R19,0X7F;     //****NOTE: This line is for DC case only. Change to comment in SINE and WHITENOISE case***//
	FMULS R18,R19;    // Multiplication of coefficient and input
	ADD R4,R0;      //accumulation
	ADC R5,R1;
	BRCC ABC;
	INC R6;
	ABC: SBRC R1,7;
	ADD R24,R25;    //keeps count of the number of overflow
	
	CPI R21,0X01;
	BREQ SKIP2; 
	DEC R21; 
	DEC R8;      
	BRNE LOOP2;
    
	SKIP2:// MOV R7,R5;  //buffer
	ADD R24,R24;
	ROL R5;   //Rotate left through carry
	ROL R6;   //Rotate left through carry
	
	SBC R6,R24;  //Subtracting the overflow
	ROR R6;
	ROR R5 ;
	
	MOV R21,R9;  
	CP R22,R9;
	BREQ STORE;
	INC R22; 
	MOV R21,R22; 
	STORE: ST Y+,R5; //Storing the OUTPUT in SRAM locations from 0x0060. Output is a 24-bit number(3 bytes)
	ST Y,R6;
	//ST Y,R4;

	INC YL;
	BRNE CONDITION;
	INC YH; 
    
	CONDITION: DEC R20;
	BRNE LOOP3;
    END: RJMP END;
	NOP;


	COEFF: .db 0XCE,0X0D,0X59,0X0D,0XCE  //Coefficients for 5-TAP FIR FILTER
	//below are the coefficients for 32-TAP FIR FILTER. UNcomment to change from 5 to 32 tap.Remember to Comment the above line also.
	;COEFF: .db 0XF3,0XF7,0X07,0XF0,0X01,0X00,0X06,0X0D,0X0F,0X01,0X00,0XF0,0X00,0XED,0XE0,0X35,0X35,0XE0,0XED,0X00,0XF0,0X00,0X01,0X0F,0X0D,0X06,0X00,0X01,0XF0,0X07,0XF7,0XF3                         
    
	//below is the Input (1000 samples) for the SINE WAVE at 1800Hz
	INPUT: .db 0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122,0,-122,-75,75,122
	//below is the WHITENOICE input (1000 samples) with variance -3
    ;INPUT: .db -34,-46,24,-18,16,-15,12,-111,20,80,45,40,-10,8,11,4,-36,-15,-8,-21,36,110,-57,6,-63,57,61,-72,84,-47,10,48,6,100,119,6,-83,-16,-37,-33,-49,3,91,-31,-12,51,53,21,45,38,-17,19,-13,-39,28,3,-8,13,43,17,8,12,2,-34,34,61,-23,84,-8,-11,-39,-34,-41,15,69,23,37,58,-108,-7,15,31,-57,-44,34,-5,24,-42,-71,33,52,71,-67,-58,-64,-2,-27,57,-63,-76,9,52,-35,-55,-6,-71,1,36,9,-83,-23,-13,79,40,-2,57,-45,-15,61,65,32,21,-25,32,-36,25,12,49,-18,28,34,-39,7,69,5,-13,20,-12,19,-6,-1,20,59,20,72,-88,-19,10,-36,-55,27,27,13,17,-38,-22,-5,-30,14,103,-21,28,-45,58,-42,9,-27,22,0,-2,128,-27,-2,116,-50,24,-47,45,14,28,-12,11,64,-99,-71,18,-28,-13,-65,-39,-18,-32,-38,-18,-41,58,-43,79,-16,-63,-27,41,46,7,12,27,-63,-25,-79,-19,41,31,99,7,-94,73,56,-25,10,34,17,30,-5,-2,4,-34,62,0,30,-37,-47,-4,-11,52,26,23,-63,-42,9,-15,56,58,-25,38,61,14,70,46,9,38,8,-18,16,2,-16,77,10,119,-13,24,69,118,13,-34,35,-57,-12,12,65,62,-1,40,-14,29,83,7,-13,-22,31,58,92,2,7,-27,70,-3,-21,95,35,31,-44,19,23,-47,-10,-18,23,-44,47,77,-13,-0,22,52,23,17,-21,-10,27,73,25,-52,19,-4,-11,-10,-38,-14,-34,-16,5,8,-9,-7,1,20,56,27,-12,26,-11,-77,-102,-74,-10,-27,-31,2,-29,-27,26,34,106,13,3,-25,-8,-2,-76,-11,33,-25,21,43,47,34,-98,-24,39,17,0,19,49,7,-33,-8,-9,39,18,24,6,-16,3,9,-61,8,40,-5,68,24,-18,-7,-12,10,33,-13,20,76,40,36,-35,-23,11,-4,-71,-66,45,-33,90,-96,19,0,-33,18,-34,37,3,-71,-105,-12,50,8,2,30,-60,62,-39,2,-16,6,-84,66,24,87,61,0,-41,-75,1,10,45,-41,34,3,-34,34,12,-10,81,26,-5,12,4,8,20,-26,-35,16,82,-13,-44,-10,-21,-14,21,-6,-26,-19,-57,-37,-61,-22,-47,-31,-13,-52,-1,15,-42,48,-69,-17,-64,-15,-57,-25,-32,-51,-90,25,87,96,-21,-2,-20,3,-40,-83,-2,-53,-83,103,-10,18,52,-73,18,22,4,7,-34,-46,24,-18,16,-15,12,-111,20,80,45,40,-10,8,11,4,-36,-15,-8,-21,36,110,-57,6,-63,57,61,-72,84,-47,10,48,6,100,119,6,-83,-16,-37,-33,-49,3,91,-31,-12,51,53,21,45,38,-17,19,-13,-39,28,3,-8,13,43,17,8,12,2,-34,34,61,-23,84,-8,-11,-39,-34,-41,15,69,23,37,58,-108,-7,15,31,-57,-44,34,-5,24,-42,-71,33,52,71,-67,-58,-64,-2,-27,57,-63,-76,9,52,-35,-55,-6,-71,1,36,9,-83,-23,-13,79,40,-2,57,-45,-15,61,65,32,21,-25,32,-36,25,12,49,-18,28,34,-39,7,69,5,-13,20,-12,19,-6,-1,20,59,20,72,-88,-19,10,-36,-55,27,27,13,17,-38,-22,-5,-30,14,103,-21,28,-45,58,-42,9,-27,22,0,-2,128,-27,-2,116,-50,24,-47,45,14,28,-12,11,64,-99,-71,18,-28,-13,-65,-39,-18,-32,-38,-18,-41,58,-43,79,-16,-63,-27,41,46,7,12,27,-63,-25,-79,-19,41,31,99,7,-94,73,56,-25,10,34,17,30,-5,-2,4,-34,62,0,30,-37,-47,-4,-11,52,26,23,-63,-42,9,-15,56,58,-25,38,61,14,70,46,9,38,8,-18,16,2,-16,77,10,119,-13,24,69,118,13,-34,35,-57,-12,12,65,62,-1,40,-14,29,83,7,-13,-22,31,58,92,2,7,-27,70,-3,-21,95,35,31,-44,19,23,-47,-10,-18,23,-44,47,77,-13,-0,22,52,23,17,-21,-10,27,73,25,-52,19,-4,-11,-10,-38,-14,-34,-16,5,8,-9,-7,1,20,56,27,-12,26,-11,-77,-102,-74,-10,-27,-31,2,-29,-27,26,34,106,13,3,-25,-8,-2,-76,-11,33,-25,21,43,47,34,-98,-24,39,17,0,19,49,7,-33,-8,-9,39,18,24,6,-16,3,9,-61,8,40,-5,68,24,-18,-7,-12,10,33,-13,20,76,40,36,-35,-23,11,-4,-71,-66,45,-33,90,-96,19,0,-33,18,-34,37,3,-71,-105,-12,50,8,2,30,-60,62,-39,2,-16,6,-84,66,24,87,61,0,-41,-75,1,10,45,-41,34,3,-34,34,12,-10,81,26,-5,12,4,8,20,-26,-35,16,82,-13,-44,-10,-21,-14,21,-6,-26,-19,-57,-37,-61,-22,-47,-31,-13,-52,-1,15,-42,48,-69,-17,-64,-15,-57,-25,-32,-51,-90,25,87,96,-21,-2,-20,3,-40,-83,-2,-53,-83,103,-10,18,52,-73,18,22,4,7








	